<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Web Integration | PayFast Documentation</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" type="image/png" sizes="32x32" href="publicimages/PayFast Coins.png">
    <link rel="icon" type="image/png" sizes="16x16" href="publicimages/PayFast Coins.png">
    <meta name="description" content="aa">
    <link rel="preload" href="public/assets/css/0.styles.deb70b46.css" as="style"><link rel="preload" href="public/assets/js/app.b2b794ff.js" as="script"><link rel="preload" href="public/assets/js/1.21c464c7.js" as="script"><link rel="preload" href="public/assets/js/10.5482b7ab.js" as="script"><link rel="prefetch" href="public/assets/js/11.478d2f04.js"><link rel="prefetch" href="public/assets/js/12.34ea36a0.js"><link rel="prefetch" href="public/assets/js/13.92f86c72.js"><link rel="prefetch" href="public/assets/js/14.e35842f7.js"><link rel="prefetch" href="public/assets/js/15.4e7726a6.js"><link rel="prefetch" href="public/assets/js/16.885d2226.js"><link rel="prefetch" href="public/assets/js/3.afe1939a.js"><link rel="prefetch" href="public/assets/js/4.41c25163.js"><link rel="prefetch" href="public/assets/js/5.379896d0.js"><link rel="prefetch" href="public/assets/js/6.418dcf22.js"><link rel="prefetch" href="public/assets/js/7.d940f8cd.js"><link rel="prefetch" href="public/assets/js/8.5ac1a726.js"><link rel="prefetch" href="public/assets/js/9.1c6ffaca.js">
    <link rel="stylesheet" href="public/assets/css/0.styles.deb70b46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container webIntegration-class"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/public/" class="home-link router-link-active"><img src="publicimages/PayFast Logo Colour.svg" alt="PayFast Documentation" class="logo"> <span class="site-name can-hide">PayFast Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/public/blog/" class="nav-link">
  Blogs
</a></div><div class="nav-item"><a href="/public/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://sandbox.payfast.co.za" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Sandbox
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.payfast.co.za" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PayFast Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/public/blog/" class="nav-link">
  Blogs
</a></div><div class="nav-item"><a href="/public/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://sandbox.payfast.co.za" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Sandbox
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://www.payfast.co.za" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PayFast Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/public/guide/" aria-current="page" class="active sidebar-link">Web Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/public/guide/#getting-started" class="sidebar-link">Getting Started</a></li><li class="sidebar-sub-header"><a href="/public/guide/#checkout-page-2" class="sidebar-link">Checkout Page</a></li><li class="sidebar-sub-header"><a href="/public/guide/#success-page" class="sidebar-link">Success Page</a></li><li class="sidebar-sub-header"><a href="/public/guide/#cancel-page" class="sidebar-link">Cancel Page</a></li><li class="sidebar-sub-header"><a href="/public/guide/#notify-page-itn" class="sidebar-link">Notify Page (ITN)</a></li><li class="sidebar-sub-header"><a href="/public/guide/#pdt-deprecated" class="sidebar-link">PDT (deprecated)</a></li></ul></li><li><a href="/public/guide/apiIntegration.html" class="sidebar-link">API Integration</a></li><li><a href="/public/guide/splitPayments.html" class="sidebar-link">Split payments</a></li><li><a href="/public/guide/sysInfo.html" class="sidebar-link">System Information</a></li><li><a href="/public/guide/testsAndTools.html" class="sidebar-link">Testing And Tools</a></li><li><a href="/public/guide/pci.html" class="sidebar-link">PCI Compliance</a></li><li><a href="/public/guide/faq.html" class="sidebar-link">FAQs</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="web-integration"><a href="#web-integration" class="header-anchor">#</a> Web Integration</h1> <h2 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h2> <h3 id="how-it-works"><a href="#how-it-works" class="header-anchor">#</a> How it Works</h3> <p>All that is required for a once-off payment, or to setup a recurring payment (subscription or ad hoc), is an HTML form with the necessary variables (described in the checkout page) sent to PayFast. PayFast will then process the transaction, update the merchants account, and send a payment confirmation (ITN) to the notify URL. The return variables of the payment confirmation can then be used to update your system accordingly.</p> <img src="publicimages/Getting started.png" alt="Getting Started with Payfast"> <p>There are two methods available for integrating with PayFast, ITN, which is our preferred integration method and PDT, a method that we are deprecating, and will no longer support after 2018-12-31. The main difference, besides better security in ITN, is that with ITN our server contacts your website and notifies you of the payment, whereas with PDT you are required to contact and confirm with us.</p> <p>The following is a list of pages that are generally needed on your website or application:</p> <table><thead><tr><th>NAME                               </th> <th>DESCRIPTION</th></tr></thead> <tbody><tr><td>Checkout page</td> <td>Buyer clicks a button to confirm their order and is redirected to PayFast for payment</td></tr> <tr><td>Success page</td> <td>Page on your site which the buyer sees after successful payment</td></tr> <tr><td>Cancelled page</td> <td>Page on your site which the buyer sees after payment is cancelled on PayFast</td></tr> <tr><td>Notify page</td> <td>Callback page which does all the ‘heavy lifting’ with regards to updating your database with payment information etc</td></tr></tbody></table> <h3 id="checkout-page"><a href="#checkout-page" class="header-anchor">#</a> Checkout Page</h3> <p>This page will have an HTML form, usually hidden, with a number of fields containing all the necessary information needed for PayFast to process the payment. Most shopping cart systems will have the buyer click on a ‘Confirm Order’ or ‘Pay Now’ button to submit the form and be redirected to the PayFast Payment page.</p> <h3 id="success-page-return-url"><a href="#success-page-return-url" class="header-anchor">#</a> Success Page ‘return_url’</h3> <p>This page on your site is where the buyer is redirected to, from PayFast, after a successful payment. A plain HTML page thanking the buyer for their purchase (and maybe mentioning the delivery procedure) is usually the norm. The page is specified by the return_url variable in the HTML form on the Checkout Page. If you are using the PDT method to update your custom integration this page would handle any required functionality.</p> <h3 id="cancelled-page-cancel-url"><a href="#cancelled-page-cancel-url" class="header-anchor">#</a> Cancelled Page ‘cancel_url’</h3> <p>This page (on your site) is where the buyer is redirected from PayFast if they cancel their payment. Good practice is to set this to a page which will allow the buyer to try and purchase again. Our recommendation is that you return the buyer to the Checkout Page. This page is specified by the cancel_url variable as defined in the HTML form on the Checkout Page.</p> <h3 id="notify-page-notify-url"><a href="#notify-page-notify-url" class="header-anchor">#</a> Notify Page ‘notify_url’</h3> <p>This page would do all the ‘work’ which is required (e.g. updating the order in your database), when using our ITN method. This page is ‘called’ by our server directly after a successful payment and before the user is redirected to the Success Page. If there are any communication problems, or errors, our server will try again (up to eight more times).</p> <h3 id="possible-sequence-of-events"><a href="#possible-sequence-of-events" class="header-anchor">#</a> Possible Sequence of events</h3> <p>Below is a sequence of events for a successful and unsuccessful (cancelled) payment on PayFast assuming the use of the above integration process and using the ITN method.</p> <h4 id="successful-payment"><a href="#successful-payment" class="header-anchor">#</a> Successful Payment</h4> <ol><li>Variables POSTed to PayFast from merchant website.</li> <li>Payment collected from customer through payment engine, and the ITN is posted to the notify_url</li> <li>ITN process completes</li> <li>Customer displayed success screen on PayFast</li> <li>Customer redirected to return_url on merchant website</li> <li>If first ITN was unsuccessful (eg. due to merchant server outage), ITN is attempted again after 10 minutes, up to 8 consecutive times.</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The URL to which the variables are posted is: https://www.payfast.co.za/eng/process</p></div> <h4 id="cancelled-payment"><a href="#cancelled-payment" class="header-anchor">#</a> Cancelled Payment</h4> <ol><li>Variables POSTed to PayFast from merchant</li> <li>Buyer cancels payment on PayFast during any step</li> <li>Customer displayed unsuccessful screen on PayFast</li> <li>Customer redirected to cancel_url on merchant’s site</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>No ITN is triggered for a cancelled payment</p></div> <h4 id="variable-format"><a href="#variable-format" class="header-anchor">#</a> Variable format</h4> <p>The below table describes the formats of the variables used when integrating with PayFast.</p> <table><thead><tr><th>Format                 </th> <th>Description                         </th></tr></thead> <tbody><tr><td>alphanumeric</td> <td>A-Z, a-z, 0-9</td></tr> <tr><td>alphanumeric extended</td> <td>alphanumeric and special characters _-/</td></tr> <tr><td>char</td> <td>maximum number of characters</td></tr> <tr><td>decimal</td> <td>numeric and optional decimal point .</td></tr> <tr><td>email</td> <td>valid email address</td></tr> <tr><td>numeric</td> <td>numeric digits, 0-9</td></tr> <tr><td>url/alphanumericspecial</td> <td>alphanumeric and special characters _-/:&amp;?#=+</td></tr> <tr><td>MD5 hash</td> <td>32 character hexadecimal number.</td></tr></tbody></table> <h2 id="checkout-page-2"><a href="#checkout-page-2" class="header-anchor">#</a> Checkout Page</h2> <p>The checkout or confirm page is usually the last step before the buyer will enter their payment details, allowing the buyer to review their order before paying for it.</p> <p>From the checkout page, all the necessary fields (variables) that PayFast requires to process a payment will be ‘POSTed’ to PayFast. These fields are explained in the tables below.</p> <p>There are 4 required variables for all types of integrations, with further variables required for recurring payments. The other variables are either highly recommended, or optional.</p> <p>Take note of the variables that only allow specific characters and those that have a restricted character length, as well as the order that the variables are submitted in.</p> <h3 id="variables-to-be-submitted"><a href="#variables-to-be-submitted" class="header-anchor">#</a> Variables to be submitted</h3> <h4 id="merchant-details"><a href="#merchant-details" class="header-anchor">#</a> Merchant Details</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>merchant_id</td> <td>The Merchant ID as given by the PayFast system. Used to uniquely identify the receiving account. <br> <br> <em>This can be found on the merchant’s settings page.</em></td> <td>Yes</td> <td>numeric</td></tr> <tr><td>merchant_key</td> <td>The Merchant Key as given by the PayFast system. Used to uniquely identify the receiving account. This provides an extra level of certainty concerning the correct account as both the ID and the Key must be correct in order for the transaction to proceed. <br> <br> <em>This can be found on the merchant’s settings page.</em></td> <td>Yes</td> <td>alphanumeric</td></tr> <tr><td>return_url</td> <td>The URL where the user is returned to after payment has been successfully taken.</td> <td>Optional</td> <td>url</td></tr> <tr><td>cancel_url</td> <td>The URL where the user should be redirected should they choose to cancel their payment while on the PayFast system.</td> <td>Optional</td> <td>url</td></tr> <tr><td>notify_url</td> <td>The URL which is used by PayFast to post the Instant Transaction Notifications (ITNs) for this transaction.</td> <td>Optional</td> <td>url</td></tr></tbody></table> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://sandbox.payfast.co.za/eng/process<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>merchant_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10000100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>merchant_key<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>46f0cd694581a<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>return_url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.yoursite.com/return<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cancel_url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.yoursite.com/cancel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>notify_url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://www.yoursite.com/notify<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>For the notify_url above, a variable can be specified globally on the Merchant’s PayFast account or overridden on a per transaction basis. The value provided during a transaction overrides the global setting.</p></div> <h3 id="buyer-details"><a href="#buyer-details" class="header-anchor">#</a> Buyer Details</h3> <p>While these fields are optional, it is highly recommended to provide this information (if available) as it is used to pre-populate any forms the user needs to fill in to complete payment. It decreases the time taken to complete the transaction and improves the rate of successful payment completion.</p> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>name_first</td> <td>The buyer’s first name.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>name_last</td> <td>The buyer’s last name.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>email_address</td> <td>The buyer’s email address</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>cell_number</td> <td>The buyer’s valid cell number. If the email_address field is empty, and cell_number provided, the system will use the cell_number as the username and autologin the user, if they do not have a registered account</td> <td>Optional</td> <td>numeric, 10 char</td></tr></tbody></table> <h3 id="transaction-details"><a href="#transaction-details" class="header-anchor">#</a> Transaction Details</h3> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>m_payment_id</td> <td>Unique payment ID on the merchant’s system.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>amount</td> <td>The amount which the payer must pay in ZAR.</td> <td>Yes</td> <td>decimal</td></tr> <tr><td>item_name</td> <td>The name of the item being charged for.</td> <td>Yes</td> <td>alphanumeric, 100 char</td></tr> <tr><td>item_description</td> <td>The description of the item being charged for.</td> <td>Optional</td> <td>alphanumeric, 255 char</td></tr> <tr><td>custom_int1</td> <td>A series of 5 custom integer variables (custom_int1, custom_int2…) which can be used by the merchant as pass-through variables. They will be posted back to the merchant at the completion of the transaction.</td> <td>Optional</td> <td>numeric, 255 char</td></tr> <tr><td>custom_str1</td> <td>A series of 5 custom string variables (custom_str1, custom_str2…) which can be used by the merchant as pass-through variables. They will be posted back to the merchant at the completion of the transaction.</td> <td>Optional</td> <td>alphanumeric, 255 char</td></tr></tbody></table> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>m_payment_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>01AB<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>100.00<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Test Item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>item_description<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>A test product<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>custom_int1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>custom_str1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Extra order information<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="transaction-options"><a href="#transaction-options" class="header-anchor">#</a> Transaction Options</h3> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>email_confirmation</td> <td>Whether to send email confirmation to the merchant of the transaction. Email confirmation is automatically sent to the payer.</td> <td>Optional</td> <td>1 or 0</td></tr> <tr><td>confirmation_address</td> <td>The address to send the confirmation email to.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr></tbody></table> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>email_confirmation<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>confirmation_address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>john@doe.com<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>This is a Boolean variable whose value must be 1 (on) or 0 (off).</li> <li>A variable can be specified globally on your account or overridden on a per transaction basis. The value provided during a transaction overrides the global setting.</li></ul> <h3 id="set-payment-method"><a href="#set-payment-method" class="header-anchor">#</a> Set Payment Method</h3> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>payment_method</td> <td>When this field is set, only the payment method specified can be used when the buyer reaches PayFast. <br><br>If this field is blank, or not included, then all available payment methods will be shown.<br>The values are as follows:<br> <br><ul><li> ‘eft’ – sets eft payment method <br></li></ul><ul><li> ‘cc’ – sets credit card payment method <br></li></ul><ul><li> ‘dc’ – sets debit card payment method <br></li></ul><ul><li> ‘bc’ – sets bitcoin payment method <br></li></ul><ul><li> ‘mp’ – sets masterpass payment method <br></li></ul><ul><li> ‘mc’ – sets mobicred payment method <br></li></ul><ul><li> ‘cd’ – sets cash deposit payment method <br></li></ul><ul><li> ‘sc’ – sets SCode payment method</li></ul></td> <td>Optional</td> <td>alphanumeric, 3 char</td></tr></tbody></table> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>payment_method<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="recurring-billing-details"><a href="#recurring-billing-details" class="header-anchor">#</a> Recurring Billing Details</h3> <h4 id="subscription"><a href="#subscription" class="header-anchor">#</a> Subscription</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>subscription_type</td> <td>The subscription type sets the recurring billing type to a subscription. Value is as follows: <br> <ul><li> 1 – sets type to a subscription</li></ul></td> <td>Yes (For subscription only)</td> <td>1</td></tr> <tr><td>billing_date</td> <td>The date from which future subscription payments will be made. Eg. 2016-01-01. Defaults to current date if not set.</td> <td>Optional</td> <td>Date format: YYYY-MM-DD</td></tr> <tr><td>recurring_amount</td> <td>Future recurring amount for the subscription. Defaults to the ‘amount’ value if not set. A minimum amount of R5.00 should be used as the recurring_amount.</td> <td>Optional</td> <td>decimal</td></tr> <tr><td>frequency</td> <td>The cycle period.</td> <td>Yes (For subscription only)</td> <td>numeric: <br> 3- Monthly <br>4- Quarterly<br>5- Biannual<br>6- Annual</td></tr> <tr><td>cycles</td> <td>The number of payments/cycles that will occur for this subscription. Set to 0 for infinity.</td> <td>Yes (For subscription only)</td> <td>numeric, 0 for indefinite subscription</td></tr></tbody></table> <pre>Subscription
</pre> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>subscription_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>billing_date<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2017-01-01<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>recurring_amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>123.45<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>frequency<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cycles<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="tokenized-charge"><a href="#tokenized-charge" class="header-anchor">#</a> Tokenized Charge</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>subscription_type</td> <td>The subscription type sets the recurring billing type to an ad hoc payment. Value is as follows: <br> <ul><li>2 – sets type to an ad hoc payment</li></ul></td> <td>Yes (For Ad Hoc only)</td> <td>2</td></tr></tbody></table> <pre>Tokenized Charge
</pre> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>subscription_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>subscription_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>subscription_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>subscription_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="split-payment-details"><a href="#split-payment-details" class="header-anchor">#</a> Split Payment Details</h3> <h4 id="checkout-page-variable"><a href="#checkout-page-variable" class="header-anchor">#</a> Checkout page variable</h4> <p>For a split payment, we make us of the hidden variable called setup. Note that this will not be included in the signature. The value for setup needs to contain the JSON encoded payload split_payment as per the table below.</p> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>merchant_id</td> <td>The receiving merchant</td> <td>Yes</td> <td>numeric, 8 char</td></tr> <tr><td>amount</td> <td>The amount in cents (ZAR), that will go to the receiving merchant</td> <td>Yes* (unless only percentage is used)</td> <td>numeric</td></tr> <tr><td>percentage</td> <td>The percentage allocated to the receiving merchant</td> <td>Yes* (unless only amount is used)</td> <td>numeric, 2 char</td></tr> <tr><td>min</td> <td>The minimum amount that will be split, in cents (ZAR)</td> <td>Optional</td> <td>numeric</td></tr> <tr><td>max</td> <td>The maximum amount that will be split, in cents (ZAR)</td> <td>Optional</td> <td>numeric</td></tr></tbody></table> <pre>Split Payments
</pre> <div class="language-HTML extra-class"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>setup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{ &quot;split_payment&quot; : {
                &quot;merchant_id&quot;:10000105,
                &quot;percentage&quot;:10,
                &quot;min&quot;:100,
                &quot;max&quot;:100000}}<span class="token punctuation">'</span></span> <span class="token punctuation">&gt;</span></span>
</code></pre></div><details class="custom-block details"><summary>DETAILS</summary> <p>At least one of these needs to be sent to us. It is not mandatory to send both, but if you do, PayFast will calculate the split amount using both the percentage and the amount variables submitted to us.</p></details> <h4 id="rules-for-split-payments"><a href="#rules-for-split-payments" class="header-anchor">#</a> Rules for split payments</h4> <ul><li>You will need to contact PayFast <a href="https://www.payfast.co.za/contact" target="_blank" rel="noopener noreferrer">contact PayFast<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to enable this on your account.</li> <li>Only one receiving merchant can be allocated a split payment, per transaction.</li> <li>All amounts used for the split must be in cents.</li> <li>Using this direct request method for splitting a payment will take precedence over any previously submitted split data sent or set up by the PayFast support team in the database.</li> <li>If both percentage and amount are specified, then the percentage will be deducted first, and then the amount will be deducted from the rest.</li> <li>If the split amount is smaller than the min, then the min will be used instead of the split amount.</li> <li>If the split amount is bigger than the max, then the max will be used instead of the split amount.</li></ul> <h3 id="security-features"><a href="#security-features" class="header-anchor">#</a> Security Features</h3> <h4 id="the-signature"><a href="#the-signature" class="header-anchor">#</a> The Signature</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>signature</td> <td>A security signature of the transmitted data taking the form of an MD5 hash of the submitted variables. <br> <br>The string from which the hash is created, is the concatenation of the name value pairs of all the non-blank variables with ‘&amp;’ used as a separator eg. name_first=John&amp;name_last=Doe&amp;email_address=… where pairs are listed in the order in which they appear on this page. <br> <br> The string from which the hash is created, is the concatenation of the name value pairs of all the non-blank variables with ‘&amp;’ used as a separator eg. name_first=John&amp;name_last=Doe&amp;email_address=… where pairs are listed in the order in which they appear on this page. <br> <br> This hash will be regenerated by the PayFast engine and the values compared to ensure the integrity of the data transfer.</td> <td>Yes</td> <td>MD5 hash, characters must be in lower case</td></tr></tbody></table> <div class="language-HTML extra-class"><pre class="language-html"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>signature<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>f103e22c0418655fb03991538c51bfd5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
               
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="the-order-of-the-checkout-variables"><a href="#the-order-of-the-checkout-variables" class="header-anchor">#</a> The order of the checkout variables</h4> <p>The order in which the checkout page variables and urlencoded values are submitted is vitally important, and allows PayFast to ensure the integrity of the data transfer by way of the signature. It is a set order, the same as they appear in the tables above.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// Construct variables </span>
<span class="token variable">$cartTotal</span> <span class="token operator">=</span> xxxx<span class="token punctuation">;</span><span class="token comment">// This amount needs to be sourced from your application</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token comment">// Merchant details</span>
    <span class="token single-quoted-string string">'merchant_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'10000100'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'merchant_key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'46f0cd694581a'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'return_url'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://www.yourdomain.co.za/thank-you.html'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'cancel_url'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://www.yourdomain.co.za/cancelled-transction.html'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'notify_url'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://www.yourdomain.co.za/itn.php'</span><span class="token punctuation">,</span>
    <span class="token comment">// Buyer details</span>
    <span class="token single-quoted-string string">'name_first'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'First Name'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'name_last'</span>  <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Last Name'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'email_address'</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'valid@email_address.com'</span><span class="token punctuation">,</span>
    <span class="token comment">// Transaction details</span>
    <span class="token single-quoted-string string">'m_payment_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'8542'</span><span class="token punctuation">,</span> <span class="token comment">//Unique payment ID to pass through to notify_url</span>
    <span class="token comment">// Amount needs to be in ZAR</span>
    <span class="token comment">// If multicurrency system its conversion has to be done before building this array</span>
    <span class="token single-quoted-string string">'amount'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">number_format</span><span class="token punctuation">(</span> <span class="token function">sprintf</span><span class="token punctuation">(</span> <span class="token double-quoted-string string">&quot;%.2f&quot;</span><span class="token punctuation">,</span> <span class="token variable">$cartTotal</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'.'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'item_name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Item Name'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'item_description'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Item Description'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'custom_int1'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'9586'</span><span class="token punctuation">,</span> <span class="token comment">//custom integer to be passed through           </span>
    <span class="token single-quoted-string string">'custom_str1'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'custom string is passed along with transaction to notify_url page'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>        

<span class="token comment">// Create parameter string</span>
<span class="token variable">$pfOutput</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span> <span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$val</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
        <span class="token variable">$pfOutput</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$key</span> <span class="token punctuation">.</span><span class="token single-quoted-string string">'='</span><span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span> <span class="token function">trim</span><span class="token punctuation">(</span> <span class="token variable">$val</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token single-quoted-string string">'&amp;'</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Remove last ampersand</span>
<span class="token variable">$getString</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span> <span class="token variable">$pfOutput</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Uncomment the next line and add a passphrase if there is one set on the account </span>
<span class="token comment">//$passPhrase = '';</span>
<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token keyword">isset</span><span class="token punctuation">(</span> <span class="token variable">$passPhrase</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$getString</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token single-quoted-string string">'&amp;passphrase='</span><span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span> <span class="token function">trim</span><span class="token punctuation">(</span> <span class="token variable">$passPhrase</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>   
<span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'signature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span> <span class="token variable">$getString</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

</span></code></pre></div><pre> This array can then also be used in generating the form output. </pre> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// If in testing mode make use of either sandbox.payfast.co.za or www.payfast.co.za</span>
<span class="token variable">$testingMode</span> <span class="token operator">=</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
<span class="token variable">$pfHost</span> <span class="token operator">=</span> <span class="token variable">$testingMode</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'sandbox.payfast.co.za'</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">'www.payfast.co.za'</span><span class="token punctuation">;</span>
<span class="token variable">$htmlForm</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'&lt;form action=&quot;https://'</span><span class="token punctuation">.</span><span class="token variable">$pfHost</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'/eng/process&quot; method=&quot;post&quot;&gt;'</span><span class="token punctuation">;</span> 
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> 
    <span class="token variable">$htmlForm</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token single-quoted-string string">'&lt;input name=&quot;'</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'&quot; type=&quot;hidden&quot; value=&quot;'</span><span class="token punctuation">.</span><span class="token variable">$value</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'&quot; /&gt;'</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token variable">$htmlForm</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token single-quoted-string string">'&lt;input type=&quot;submit&quot; value=&quot;Pay Now&quot; /&gt;&lt;/form&gt;'</span><span class="token punctuation">;</span> 
<span class="token keyword">echo</span> <span class="token variable">$htmlForm</span><span class="token punctuation">;</span>
</span></code></pre></div><p>When the data transmitted from the checkout page is received by PayFast, the MD5 hash will be regenerated by PayFast from the supplied data, in the set order, and the resulting hash will be compared with the signature received. If the hash created, from the checkout variables supplied, does not match the signature, then the payment will fail. The string from which the hash is created, is the concatenation of the name value pairs of all the non-blank variables with ‘&amp;’ used as a separator eg:</p> <p><span style="background-color:#e6e6ff;">name_first=John&amp;name_last=Doe&amp;email_address=john.doe@example.com..</span></p> <h4 id="passphrase"><a href="#passphrase" class="header-anchor">#</a> Passphrase</h4> <p>The passphrase is an optional/ extra security feature, made up of a maximum of 32 characters, which is set by the Merchant in the Settings section of their PayFast Dashboard. The identical passphrase must be used on the merchant’s site.</p> <p>The passphrase is used to ‘salt’ the parameter string before it is MD5 hashed to generate the signature.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The passphrase does not get passed to the server like the other variables</p></div> <p>This further aids in ensuring the integrity of the data that is being passed through when payment is made.</p> <h3 id="example-checkout-page"><a href="#example-checkout-page" class="header-anchor">#</a> Example Checkout Page</h3> <img src="publicimages/page-checkout.png" alt="An example of a checkout page."> <h4 id="common-causes-of-a-failed-integration-signature-mismatch"><a href="#common-causes-of-a-failed-integration-signature-mismatch" class="header-anchor">#</a> Common causes of a failed integration / signature mismatch</h4> <p>The following will cause a signature mismatch or a payment to fail:</p> <ol><li><p><b>The order of the variables</b> in parameter string (to create the signature/MD5 hash) does not mirror the order as presented above. This is the most likely cause of a signature mismatch! It is critical that the variables are concatenated in the order as they appear in the tables above.</p></li> <li><p><b>A required field is missing</b></p></li> <li><p>A field is greater than the allowable <b>character length</b></p></li> <li><p>Any of the fields containing <b>non-allowable characters</b></p></li> <li><p>The Parameter string has been <b>URLencoded incorrectly</b>. The resultant URLencoding has to be show upper case, for example, <span style="background-color:#e6e6ff;">http%3A%2F%2</span> and not lower case like <span style="background-color:#e6e6ff;">http%3A%2F%2</span>.</p></li> <li><p>The Parameter string has not been trimmed of <b>white spaces</b> on the ends. Please make use of PHP’s <a href="https://www.php.net/manual/en/function.trim.php" target="_blank" rel="noopener noreferrer">trim()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> function to avoid this.</p></li></ol> <h2 id="success-page"><a href="#success-page" class="header-anchor">#</a> Success Page</h2> <p>The success page, or return page, is used to show the buyer that the payment has been successfully received and provides any necessary details about the order.</p> <p>This page is determined by the value set on the return_url field of the form submitted from the checkout page. It is possible to add a cart id, or order id, onto the return_url which the merchant’s system can then use to access the necessary information from the database to be displayed to the user on the success page.</p> <details class="custom-block details"><summary>DETAILS</summary> <p>All return variables are sent to the notify_url only, no data is sent to the <code>return_url</code></p></details> <h3 id="success-page-example-return-page"><a href="#success-page-example-return-page" class="header-anchor">#</a> Success page example (Return page)</h3> <img src="publicimages/page-success.png" alt="An example of a Successfull checkout page."> <h2 id="cancel-page"><a href="#cancel-page" class="header-anchor">#</a> Cancel Page</h2> <p>This page is where buyers are redirected to if they cancel the payment transaction at any stage. It is defined by the cancel_url field that is set on the shopping cart or client checkout page prior to being redirected to the PayFast payment engine.</p> <p>If you are saving the user’s purchase information prior to being redirected, it is common practice to present that information to the buyer on this page to encourage them to complete the transaction or continue shopping. Many eCommerce solutions set the cancel_url field to the same page as the shopping cart page to get the buyer to retry (or reconsider) paying.</p> <h3 id="cancel-page-example"><a href="#cancel-page-example" class="header-anchor">#</a> Cancel Page Example</h3> <img src="publicimages/page-cancel.png" alt="An example of a Cancelled checkout page."> <h2 id="notify-page-itn"><a href="#notify-page-itn" class="header-anchor">#</a> Notify Page (ITN)</h2> <img src="publicimages/itn-callback-flow.png" alt="An example of how the Notifications work with PayFast."> <p>The payment notification (Instant Transaction Notification – ITN) communicates with the notify_url, which is a  field set on the  form sent from the checkout page, allowing for the exchange of data between the two web servers after a successful transaction. The notify_url should process the following:</p> <ol><li>Receive the data posted by PayFast</li> <li>Notify PayFast that the information has been received</li> <li>Perform security checks
  <ul><li> Verify the security signature is valid </li></ul> <ul><li> Verify the source IP address belongs to PayFast </li></ul> <ul><li> Verify the payment amount matches your order amount </li></ul> <ul><li> Verify the data received is valid </li></ul></li> <li>Verify that the order hasn’t been processed already</li> <li>Process the order
  <ul><li> Update the status to paid </li></ul> <ul><li> Email the buyer confirming payment </li></ul></li></ol> <h3 id="return-variables"><a href="#return-variables" class="header-anchor">#</a> Return Variables</h3> <p>Detailed below are the possible variables returned to the receiver as part of an ITN from PayFast.</p> <h4 id="transaction-details-2"><a href="#transaction-details-2" class="header-anchor">#</a> Transaction details</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>m_payment_id</td> <td>Unique payment ID on the merchant’s system.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>pf_payment_id</td> <td>Unique transaction ID on PayFast.</td> <td>Required</td> <td>numeric</td></tr> <tr><td>payment_status</td> <td>After a successful payment the status sent will be COMPLETE. When a subscription is cancelled the status will be CANCELLED.</td> <td>Required</td> <td>COMPLETE or CANCELLED</td></tr> <tr><td>item_name</td> <td>The name of the item being charged for.</td> <td>Required</td> <td>alphanumeric, 100 char</td></tr> <tr><td>item_description</td> <td>The description of the item being charged for.</td> <td>Optional</td> <td>alphanumeric, 255 char</td></tr> <tr><td>amount_gross</td> <td>The total amount which the payer paid.</td> <td>Required</td> <td>decimal</td></tr> <tr><td>amount_fee</td> <td>The total in fees which was deducted from the amount.</td> <td>Required</td> <td>decimal</td></tr> <tr><td>amount_net</td> <td>The net amount credited to the receiver’s account.</td> <td>Required</td> <td>decimal</td></tr> <tr><td>custom_str1</td> <td>The series of 5 custom string variables (custom_str1, custom_str2…) originally passed by the receiver during the payment request.</td> <td>Optional</td> <td>alphanumeric, 255 char</td></tr> <tr><td>custom_int1</td> <td>The series of 5 custom integer variables (custom_int1, custom_int2…) originally passed by the receiver during the payment request.</td> <td>Optional</td> <td>numeric</td></tr></tbody></table> <h4 id="buyer-details-2"><a href="#buyer-details-2" class="header-anchor">#</a> Buyer details</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>name_first</td> <td>The buyer’s first name.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>name_last</td> <td>The buyer’s last name.</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr> <tr><td>email_address</td> <td>The buyer’s email address</td> <td>Optional</td> <td>alphanumeric, 100 char</td></tr></tbody></table> <h4 id="merchant-details-2"><a href="#merchant-details-2" class="header-anchor">#</a> Merchant details</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>merchant_id</td> <td>The Merchant ID as given by the PayFast system. Used to uniquely identify the receiver’s account.</td> <td>Required</td> <td>numeric</td></tr></tbody></table> <h4 id="recurring-billing-details-2"><a href="#recurring-billing-details-2" class="header-anchor">#</a> Recurring billing details</h4> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>token</td> <td>Unique ID on PayFast that represents the subscription</td> <td>Required</td> <td>alphanumeric, 36 char</td></tr></tbody></table> <details class="custom-block details"><summary>DETAILS</summary> <p>Should the buyer / subscriber cancel a subscription, an ITN call may be made. In this case, the payment_status field may return an additional status value.</p></details> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>billing_date</td> <td>The date from which future subscription payments will be made. Eg. 2016-01-01. Defaults to current date if not set.</td> <td>Optional</td> <td>Date format: YYYY-MM-DD</td></tr></tbody></table> <h3 id="security-information"><a href="#security-information" class="header-anchor">#</a> Security information</h3> <table><thead><tr><th>NAME</th> <th>DESCRIPTION</th> <th>REQUIRED</th> <th>FORMAT</th></tr></thead> <tbody><tr><td>signature</td> <td>A security signature of the transmitted data taking the form of an MD5 hash of all the url encoded submitted variables. The string from which the hash is created, is the concatenation of the name value pairs of all variables (including the blank variables) with ‘&amp;’ used as a separator eg. “name_first=John&amp;name_last=Doe&amp;email_address=…” where pairs are listed in the order in which they appear in the $_POST data. This hash will be regenerated by the PayFast engine and the values compared to ensure the integrity of the data transfer.</td> <td>Optional</td> <td>MD5 hash, characters must be in lower case</td></tr></tbody></table> <p>If the ITN callback method has been used, part of the security checking stage is confirming the received data’s signature (see security check one).</p> <p>If you have a passphrase set on your account “Settings” page, it will need to be added to the string used to generate the signature. The passphrase is never published or given out. It serves as an extra security measure to ensure that all information is accurate and has not been tampered with.</p> <h3 id="step-one"><a href="#step-one" class="header-anchor">#</a> Step one</h3> <p>Receive the payment information from PayFast and then tell PayFast that this page is reachable by triggering a header 200, the payment engine will make a few attempts, one immediately and then one after 10 minutes again, then exponentially at longer intervals, until it receives an OK 200 from your web server. Once the ITN receives the OK 200 there will be no further communication with the ITN.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The return variables will not be posted to your server if it does not respond with a header of 200 OK</p></div> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'HTTP/1.0 200 OK'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><pre>Store the posted data in:</pre> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">define</span><span class="token punctuation">(</span> <span class="token single-quoted-string string">'SANDBOX_MODE'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$pfHost</span> <span class="token operator">=</span> <span class="token constant">SANDBOX_MODE</span> <span class="token operator">?</span> <span class="token single-quoted-string string">'sandbox.payfast.co.za'</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">'www.payfast.co.za'</span><span class="token punctuation">;</span>
<span class="token comment">// Posted variables from ITN</span>
<span class="token variable">$pfData</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>

<span class="token comment">// Strip any slashes in data</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span> <span class="token variable">$pfData</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$val</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$pfData</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span> <span class="token variable">$val</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="step-two"><a href="#step-two" class="header-anchor">#</a> Step two</h3> <p>Conduct four security checks to ensure that the data you are receiving is correct, from the correct source and hasn’t been altered; you should not continue the process if a test fails!</p> <h3 id="security-check-one"><a href="#security-check-one" class="header-anchor">#</a> Security check one</h3> <p>Verify the security signature in the data array; this is done in a similar way that the signature that you generated for stage one of the user payment flow. It is to ensure that there hasn’t been any middle man attacks and changing of values within the received data. The string that gets created needs to include all fields posted from PayFast.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If a passphrase has been set in the PayFast Settings, then it needs to be included in the signature string</p></div> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// $pfData includes of ALL fields posted through from PayFast, plus the empty strings</span>
<span class="token variable">$pfData</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">;</span>

<span class="token comment">// Construct variables </span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span> <span class="token variable">$pfData</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$val</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$key</span> <span class="token operator">!=</span> <span class="token single-quoted-string string">'signature'</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$pfParamString</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$key</span> <span class="token punctuation">.</span><span class="token single-quoted-string string">'='</span><span class="token punctuation">.</span> <span class="token function">urlencode</span><span class="token punctuation">(</span> <span class="token variable">$val</span> <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token single-quoted-string string">'&amp;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Remove the last '&amp;' from the parameter string</span>
<span class="token variable">$pfParamString</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span> <span class="token variable">$pfParamString</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$pfTempParamString</span> <span class="token operator">=</span> <span class="token variable">$pfParamString</span><span class="token punctuation">;</span>
<span class="token comment">// Passphrase stored in website database</span>
<span class="token variable">$passPhrase</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span> <span class="token variable">$passPhrase</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$pfTempParamString</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token single-quoted-string string">'&amp;passphrase='</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span> <span class="token variable">$passPhrase</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span> <span class="token variable">$pfTempParamString</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$signature</span><span class="token operator">!=</span><span class="token variable">$pfData</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Invalid Signature'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="security-check-two"><a href="#security-check-two" class="header-anchor">#</a> Security check two</h3> <p>With this test you will be checking to ensure that your application is communicating with a valid PayFast payment engine.</p> <p>The following is a list of valid domains:</p> <ul><li>www.payfast.co.za</li> <li>w1w.payfast.co.za</li> <li>w2w.payfast.co.za</li> <li>sandbox.payfast.co.za</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// Variable initialization</span>
<span class="token variable">$validHosts</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token single-quoted-string string">'www.payfast.co.za'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'sandbox.payfast.co.za'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'w1w.payfast.co.za'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'w2w.payfast.co.za'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$validIps</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span><span class="token punctuation">(</span> <span class="token variable">$validHosts</span> <span class="token keyword">as</span> <span class="token variable">$pfHostname</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$ips</span> <span class="token operator">=</span> <span class="token function">gethostbynamel</span><span class="token punctuation">(</span> <span class="token variable">$pfHostname</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$ips</span> <span class="token operator">!==</span> <span class="token boolean constant">false</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$validIps</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span> <span class="token variable">$validIps</span><span class="token punctuation">,</span> <span class="token variable">$ips</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Remove duplicates</span>
<span class="token variable">$validIps</span> <span class="token operator">=</span> <span class="token function">array_unique</span><span class="token punctuation">(</span> <span class="token variable">$validIps</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$validIps</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Source IP not Valid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="security-check-three"><a href="#security-check-three" class="header-anchor">#</a> Security check three</h3> <p>Check payment data against the merchant’s order. This can be determined by comparing the amount processed for payment and the amount of the cart in your application and seeing if they match.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$cartTotal</span> <span class="token operator">=</span> xxxx<span class="token punctuation">;</span> <span class="token comment">// This amount needs to be sourced from your application</span>
<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">abs</span><span class="token punctuation">(</span> <span class="token function">floatval</span><span class="token punctuation">(</span> <span class="token variable">$cartTotal</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">floatval</span><span class="token punctuation">(</span> <span class="token variable">$pfData</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'amount_gross'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.01</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Amounts Mismatch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="security-check-four"><a href="#security-check-four" class="header-anchor">#</a> Security check four</h3> <p>Using cURL, validate the data that you have received from PayFast by contacting our server and confirming the order details.</p> <h4 id="live-validation-url"><a href="#live-validation-url" class="header-anchor">#</a> Live validation URL:</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>https://www.payfast.co.za/eng/query/validate</p></div> <h4 id="sandbox-validation-url"><a href="#sandbox-validation-url" class="header-anchor">#</a> Sandbox validation URL:</h4> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>https://sandbox.payfast.co.za/eng/query/validate</p></div> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// Variable initialization</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'https://'</span><span class="token punctuation">.</span> <span class="token variable">$pfHost</span> <span class="token punctuation">.</span><span class="token single-quoted-string string">'/eng/query/validate'</span><span class="token punctuation">;</span>

<span class="token comment">// Create default cURL object</span>
<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set cURL options - Use curl_setopt for greater PHP compatibility</span>
<span class="token comment">// Base settings</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token boolean constant">false</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>      
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYHOST</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_SSL_VERIFYPEER</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Standard settings</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POST</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_setopt</span><span class="token punctuation">(</span> <span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_POSTFIELDS</span><span class="token punctuation">,</span> <span class="token variable">$pfParamString</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Execute CURL</span>
<span class="token variable">$response</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span> <span class="token variable">$ch</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">curl_close</span><span class="token punctuation">(</span> <span class="token variable">$ch</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$lines</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span> <span class="token double-quoted-string string">&quot;\r\n&quot;</span><span class="token punctuation">,</span> <span class="token variable">$response</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$verifyResult</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span> <span class="token variable">$lines</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">strcasecmp</span><span class="token punctuation">(</span> <span class="token variable">$verifyResult</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'VALID'</span> <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Data not valid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>The following table contains a detailed description of each of the cURL options used in the code snippet to the right.</p> <table><thead><tr><th>OPTION</th> <th>DESCRIPTION</th></tr></thead> <tbody><tr><td>CURLOPT_RETURNTRANSFER</td> <td>Set to TRUE to return the transfer as a string of the return value of <a href="http://php.net/manual/en/function.curl-exec.php" target="_blank" rel="noopener noreferrer">curl_exec()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> instead of outputting it out directly.</td></tr> <tr><td>CURLOPT_HEADER</td> <td>Set to False to exclude the header in the output.</td></tr> <tr><td>CURLOPT_SSL_VERIFYHOST</td> <td>Set to 2 to check the existence of a common name in the SSL peer certificate, and to also verify that it matches the hostname provided.</td></tr> <tr><td>CURLOPT_SSL_VERIFYPEER</td> <td>This option determines whether curl verifies the authenticity of the peer’s certificate. The default value is 1.</td></tr> <tr><td>CURLOPT_URL</td> <td>Set to the PayFast query validation URL, eg. https://www.payfast.co.za/eng/query/validate. This can also be set when initializing a session with <a href="http://php.net/manual/en/function.curl-init.php" target="_blank" rel="noopener noreferrer">curl_init()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</td></tr> <tr><td>CURLOPT_POST</td> <td>Set to TRUE to do a regular HTTP POST. This POST is the normal application/x-www-form-urlencoded kind, most commonly used by HTML forms.</td></tr> <tr><td>CURLOPT_POSTFIELDS</td> <td>The full data to post via HTTP to PayFast. This parameter is passed as a urlencoded string, such as: <br> <span style="background-color:#e6e6ff;">m_payment_id=01&amp;pf_payment_id=01234..</span></td></tr></tbody></table> <h3 id="step-three"><a href="#step-three" class="header-anchor">#</a> Step three</h3> <p>Query your database and compare the pf_payment_id in order to verify that the order hasn’t already been processed on your system.</p> <div class="language-php extra-class"><pre class="language-php"><code>    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token variable">$pfPaymentId</span> <span class="token operator">=</span> <span class="token variable">$pfData</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'pf_payment_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span></code></pre></div><h3 id="step-four"><a href="#step-four" class="header-anchor">#</a> Step four</h3> <p>Once you have completed these tests and the data received is valid, check the payment status and handle appropriately.</p> <div class="language-php extra-class"><pre class="language-php"><code>Copy<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token variable">$pfData</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'payment_status'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'COMPLETE'</span> <span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
    <span class="token comment">// If complete, update your application</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">else</span>
 <span class="token punctuation">{</span>
    <span class="token comment">// If unknown status, do nothing (which is the safest course of action)</span>
 <span class="token punctuation">}</span>
</span></code></pre></div><pre> For Recurring billing only: </pre> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">switch</span><span class="token punctuation">(</span> <span class="token variable">$pfData</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'payment_status'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token single-quoted-string string">'COMPLETE'</span><span class="token punctuation">:</span>
    <span class="token comment">// If complete, update your application</span>
       <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token single-quoted-string string">'CANCEL'</span><span class="token punctuation">:</span>
    <span class="token comment">// If cancel, then cancel subscription</span>
       <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token comment">// If unknown status, do nothing (which is the safest course of action)</span>
       <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h2 id="pdt-deprecated"><a href="#pdt-deprecated" class="header-anchor">#</a> PDT (deprecated)</h2> <img src="publicimages/PDT-v2.png" alt="working with PDT Payfast"> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The PDT integration method is deprecated and will be discontinued by 2018-12-31</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/public/guide/apiIntegration.html">
        API Integration
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="public/assets/js/app.b2b794ff.js" defer></script><script src="public/assets/js/1.21c464c7.js" defer></script><script src="public/assets/js/10.5482b7ab.js" defer></script>
  </body>
</html>
